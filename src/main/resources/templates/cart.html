<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Shopping Cart - Bookstore</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>

<body>
    <div th:replace="~{fragments/header :: nav}"></div>

    <div class="container">
        <h1>Shopping Cart</h1>

        <div th:if="${param.error == 'empty'}" class="alert alert-danger">
            Your cart is empty. Please add items before checkout.
        </div>

        <div th:if="${#lists.isEmpty(cartItems)}">
            <div style="text-align: center; padding: 3rem; background: white; border-radius: 8px;">
                <h3>Your cart is empty</h3>
                <p style="color: #666; margin: 1rem 0;">Browse our collection and add some books!</p>
                <a th:href="@{/books}" class="btn">Browse Books</a>
            </div>
        </div>

        <div th:if="${!#lists.isEmpty(cartItems)}">
            <div style="background: white; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #eee;">
                            <th style="padding: 1rem; text-align: left;">Book</th>
                            <th style="padding: 1rem; text-align: center;">Price</th>
                            <th style="padding: 1rem; text-align: center;">Quantity</th>
                            <th style="padding: 1rem; text-align: right;">Total</th>
                            <th style="padding: 1rem; text-align: center;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${cartItems}" style="border-bottom: 1px solid #eee;">
                            <td style="padding: 1rem;">
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <img th:if="${item.book.coverImage != null}" 
                                         th:src="@{'/images/books/' + ${item.book.coverImage}}" 
                                         alt="Book Cover"
                                         style="width: 60px; height: 80px; object-fit: cover; border-radius: 4px;">
                                    <div th:if="${item.book.coverImage == null}" 
                                         style="width: 60px; height: 80px; background: #f0f0f0; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; color: #999;">
                                        No Image
                                    </div>
                                    <div>
                                        <div style="font-weight: 600;" th:text="${item.book.title}">Book Title</div>
                                        <div style="color: #666; font-size: 0.9rem;" th:text="${item.book.author}">Author</div>
                                    </div>
                                </div>
                            </td>
                            <td style="padding: 1rem; text-align: center;">
                                <span th:text="'$' + ${#numbers.formatDecimal(item.book.price, 1, 2)}">$0.00</span>
                            </td>
                            <td style="padding: 1rem; text-align: center;">
                                <form th:action="@{/cart/update}" method="post" style="display: inline-flex; align-items: center; gap: 0.5rem;">
                                    <input type="hidden" name="bookId" th:value="${item.book.id}">
                                    <input type="number" name="quantity" th:value="${item.quantity}" 
                                           min="1" max="99" 
                                           style="width: 60px; padding: 0.25rem; text-align: center; border: 1px solid #ddd; border-radius: 4px;">
                                    <button type="submit" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">Update</button>
                                </form>
                            </td>
                            <td style="padding: 1rem; text-align: right; font-weight: 600;">
                                <span th:text="'$' + ${#numbers.formatDecimal(item.totalPrice, 1, 2)}">$0.00</span>
                            </td>
                            <td style="padding: 1rem; text-align: center;">
                                <a th:href="@{'/cart/remove/' + ${item.book.id}}" 
                                   onclick="return confirm('Remove this item from cart?');"
                                   style="color: #e74c3c; text-decoration: none; font-weight: 500;">
                                    Remove
                                </a>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid #eee; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <a th:href="@{/books}" style="color: #3498db; text-decoration: none;">‚Üê Continue Shopping</a>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">
                            Total: <span th:text="'$' + ${#numbers.formatDecimal(totalAmount, 1, 2)}">$0.00</span>
                        </div>
                        <a th:href="@{/checkout}" class="btn" style="font-size: 1.1rem; padding: 0.75rem 2rem;">
                            Proceed to Checkout
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>
</body>

</html>
